BreathCheck Codebase Explainer (Developer Reference)

1) High-Level Architecture
BreathCheck follows a layered architecture:
- ui/: PyQt5 views, widgets, dialogs, page routing, user interaction.
- domain/: entities and domain services (business logic and derived metrics).
- data/: SQLAlchemy models, database setup, repositories.
- services/: integrations and app-level services (AI client, settings IO, feedback service).

Key principle:
- UI should call services/repositories, not direct SQLAlchemy operations.

2) Startup Flow
Main entry:
- src/anxiety_app/main.py

Startup steps:
- Load config and logging.
- Create QApplication and set app icon.
- Initialize SQLAlchemy engine/session and create tables.
- Construct domain/services and MainWindow.
- Apply theme and window constraints.
- Show login/onboarding/app stack.

3) Main Window and Navigation
Main container:
- src/anxiety_app/ui/main_window.py

Core UI structure:
- Sidebar + stacked main views.
- Current navigation set:
  - Learn
  - Tools
  - Progress
  - Support
  - Settings

Responsibilities:
- Page switching
- Cross-page signals (toasts, refreshes)
- Login/onboarding gate
- Fixed window sizing and appearance application

4) Data Layer
Database setup:
- src/anxiety_app/data/db.py

ORM models:
- src/anxiety_app/data/models.py

Important models:
- DailyLog: daily tracking entries.
- ModuleProgress: module lock/unlock/complete state and percent.
- UserModuleData: JSON payload for module-specific saved answers.
- ToolEntry: tool submissions (e.g., thought log content).
- ToolUsage: usage analytics events (tool_name + metadata_json).
- UserSettings: reminder/theme/comfort/onboarding preferences.
- SupportContact / SupportResource: support page saved items.

Time handling:
- Uses timezone-aware UTC defaults (`datetime.now(UTC)`).

5) Domain Services
Main domain service module:
- src/anxiety_app/domain/services.py

Common responsibilities:
- Create/update/retrieve tracker data.
- Save/load module data.
- Update module progress with sequential unlock rules.
- Compute progress metrics and milestone statuses.
- Manage support contacts/resources.

6) Learn Module Implementation
Primary Learn UI:
- src/anxiety_app/ui/widgets/learn_view.py

Current behavior:
- 6 module cards in overview.
- Sequential unlock via ModuleProgress.
- Module 1 implemented as step wizard with persistence.
- Overview page for saved inputs.
- Resume support via `last_step_index`.
- Optional media placeholders (image/audio) per step.

Performance notes:
- Overview rebuild guarded by signature cache to avoid unnecessary redraws.

7) Tools Implementation
Tools page:
- src/anxiety_app/ui/widgets/tools_view.py

Active tools:
- BreathCheck breathing session (pace/duration, start/pause, usage saved).
- Thought Log (structured form, save entry, optional AI feedback stream).

Background processing:
- Uses QThread + worker object for non-blocking feedback streaming.
- UI receives chunked updates and appends incrementally.

8) Progress and Milestones
Progress page:
- src/anxiety_app/ui/widgets/progress_view.py

Displays:
- Module completion
- Weekly engagement
- Streak
- Tool usage summary
- Milestones grid (with optional local images)

Milestone computation location:
- Domain services layer (not directly in UI).

9) Support and Settings
Support page:
- src/anxiety_app/ui/widgets/support_view.py
- Allows storing personal contacts/resources and deleting entries.

Settings page:
- src/anxiety_app/ui/widgets/settings_view.py
- Security/account actions, theme/comfort/reminder options, export/reset operations.

10) Styling and Theme System
Base styling:
- src/anxiety_app/ui/style.qss

Theme application:
- src/anxiety_app/ui/theme.py

Shared widget utilities:
- src/anxiety_app/ui/widgets/card_widgets.py
  - CardFrame
  - CompactCard
  - clear_layout

11) Security and Privacy
Core security helpers:
- src/anxiety_app/core/security.py

Privacy model:
- Local-first storage (SQLite on device).
- No raw personal entries should be written to logs.
- Master password and sensitive config paths handled via settings/security services.

12) Testing
Tests located in:
- src/anxiety_app/tests/

Current test groups:
- model tests
- service tests
- UI smoke tests

Typical run command:
- /home/jxmppng/Documents/Projects/BC_TEST/.venv/bin/python -m pytest src/anxiety_app/tests

13) Recommended Development Workflow
- Implement in service/repository first, then wire UI.
- Keep UI signals thin and deterministic.
- Avoid blocking calls in UI thread.
- Reuse shared widgets to reduce duplication.
- Run py_compile and pytest before handoff.
